

Прежде всего отметим инфраструктуру банка
---

Внутреняя организация банка такая-же как и в любой обычной компании (имеет 4-звена):
1. `Руководитель` - (организатор)  у которого есть _сейф для хранения_...
   В одиночку один директор не успеет делать всю работу, поэтому у него есть помошники (сотрудники - доверенные лица)
2. `охрана для сейфа` _они выполняют основную работу в банке_ (отвечают за его сохранность)
3. `бугалтер` _он ведет подсчеты всего что хранится в сейфе, а также прием и выдачу средств клиентам_ (следит за точность и правильность)
4. `персонал для работы с клиентами` _принимают и выдавают клиентские заказы_ (помогают находить взаимопонимание между клиентами и сотрудниками банка)

Основную работу здесь выполняет охрана содержимого сейфа, а остальные сотрудники обеспечиваю помощь...

Внутреняя организация работы в банке очень простая:
- в банке есть 2-е базы: **клиентская база** и **база номеров ячеек хранения** в сейфе
- бугалтер ведет **журнал приема/выдачи** клиентских средств хранящихся в этом сейфе

Основная задача банка - это охранять клиентские средства и выдавать их клиентам...

А еще банк предоставляет сервис для перевода денежных средств между своими клиентами - 
для этой цели банк отдельно собирает клиентские **договора** и выполняет внутренние денежные переводы согласно договору...
(Такой внутрений сервис очень удобный и практичный для клиентов потому что позволяет легко и надежно выполнять платежные операции)


Ключ к ячейке сейфа
---

Банковский сейф представляет собой небольшие ячейки с номерами внутри большого сейфа, где хранятся клиентские вложения.

Электронный ключ к ячейкам сейфа, это магнитная карта в которой записана информация про:
- серия выпуска и порядковый номер карты
- дата и место изготовления
- какому банку принадлежит эта карта
- номер ячейки внутри сейфа
- пин-код (о котором знает только клиент)
- дата активации магнитной карты

_Такая информация нужна чтобы защитить уникальность выданной карты от возможной подмены и дубликатов_
Такая электронная карта выпускается для ячейки с конкретным номером в банковском сейфе.
И после ее выпуска сразу-же регистрируется в базе даных банковских электронных карт...

Когда такая электронная карта выдается клиенту - в базе данных банка регистрируется новый клиент и ему присваивается эта карта.
(Каждый клиент может иметь больше одной электронной карты...)

+ [dmitryga.ru/2013/640](http://dmitryga.ru/2013/640)
+ [habrahabr.ru/post/190258](https://habrahabr.ru/post/190258)
+ [bankirsha.com/pro-cvv2-cvc2](https://bankirsha.com/pro-cvv2-cvc2.html)
+ [wap.gazprombank.ru/private/service/bank_cards/faq/285471](http://wap.gazprombank.ru/private/service/bank_cards/faq/285471)

В базе данных банка хранится приватная информация об клиентах, это:
- паспортные данные (ФИО, прописка, номер паспорта)
- текуще место проживания
- контактный номер телефона


Договор
---

Договоры бывают разные..., _договор - представляет сложный социальный механизм защиты прав для клиентов обеих сторон (и для продавца и для покупателя)_

Человек который продает товары на рынке - он предоставляет одноразовую услугу для своих клиентов-покупателей.
Такого продавца могут легко обмануть или наоборот, сам продавец может обманывать своих покупателей...
(В этом случае никто не защищен...)

Для заключения договора должны принимать участие 3-и стороны:
1. Продавец услуг
2. Клиент (покупатель) услуги
3. Сотрудник по социальной безопасности

В договоре указано:
- услуги которые должен предоставить продавец...
- стоимость и сроки оплаты со стороны клиента
- персональные паспортные данные продавца и клиента (чтобы можно было разыскать клиентов с помощью милиции...)
- завереность договора со всех 3-х сторон

_Такой договор составляется в 2-х экземплярах: 1-экземпляр для продавца; 2-экземпляр для клиента;_

Для этого сервиса в банке есть еще две базы данных, это:
- **договор продажи**
- **договор купли**

Чтобы защитить себя от разных недоразумений перед своими клиентами, банк использует схему такого договора который заключается между его клиентами чтобы переводить денежные средства из ячейки сейфа одного клиента в ячейку сейфа другого клиента...

Для этой цели в банке используется **транзитный счет**: 
- когда бугалтер видит договор на продажу и договор на оплату, бугалтер проверяет сумму И если все сходится только тогда он снимает указанную сумму из ячейки клиента на этот транзитный счет А после этого выписывает этому клиенту **чек об проплате**
- дальше покупатель показывает продавцу свой **чек из банка** и забирает товар...
- (если в период проплаты что-то случилось с товаром или стороны передумали...покупатель имеет право вернуть деньги по проплаченному чеку)


#############################################################

Банк имеет несколько уровней защиты
---

1. Прежде всего это `внутреняя банковская сеть` - в пределах которой находятся под защитой и обслуживаются все компьютерные устройства.
   Каждому компьютеру выдан IP-адресс, который мониториться и обслуживается в банковской системе...
   (_это банкоматы на которые можно получить удаленный доступ внутри банка_)
2. `терминалы` - они работают внутри мобильной связи И номера телефонов такогих мобильных терминалов зарегистрированы и обслуживаются банком... 
3. банковские `веб-сайты` - такие веб-сайты получают специальный электронный (токен) ключ и имеют право доступа и используют API-банка...

Банкоматы - представляют собой выносной мобильный сейф.
В нем находится: кассовый аппарат, картоприемник, программный интерфейс (персонал-**контрагент**) для работы с клиентами
- После того когда электронная карта попадает в картоприемник, из нее считывается вся персональная информация и отправляется прямо на **основной сервер**.
  В базе данных банка выполняется проверка ее достоверности и если все хорошо тогда создается сессия на 30-секунд и основной сервер запрашивает клиентский ПИН-код для подтверждения...
- После подтверждения клиентского ПИН-кода, основной сервер возвращает auth-токен...
  Этот auth-токен получает клиентская программа (**контрагент**) уже на стороне терминала, которая помогает клиенту оформлять запросы И право использовать **API-банка** чтобы получать эти клиентские запросы...
  Основной сервер получает клиентские запросы от программы который имеет внутренний IP-адресс что зарегистрирован и обслуживается этим банком.
- Поскольку основной сервер знает IP-адресс той клиентской программы из которой шлются запросы, 
  таким образом _основной сервер через протокол чата отправляет команды по этому IP-адрессу на кассовый аппарат чтобы выдать или принять денежные купюры_

В случае если что-то сломалось или что-то неправильно отработало, клиент всегда может обратиться в банковскую службу поддержи за помощью...
(в этом случае банк выполняет для своих клиентов услугу безопасного хранения денежных средств...)

Чтобы оплатить свои покупки в магазине клиенты используют **терминал** - он похож на _банкомат_ но работает по другому:
- для терминала ненужна _программа-контрагент_, ее заменяет живой человек кассир (персонал по клиентам) который пробивает товары и оформляет проплату...
- кассир оформляет две копии договора об купли-продаже товаров и отправляет запрос на основной сервер API-банка
- дальше картоприемник работает по старому способу (клиент передает все данные из своей электронной карты на основной сервер + ПИН-код чтобы выполнить запрос на проплату договора-купли товара)
- и выполняет запрос на проплату договора-купли товара...после этого бугалтер все проверит, выполнит снятие денежных средстви из ячейки и напечатает квитанцию об проплате для покупателя...  

В этом случае для заключения договора приватная информация из паспортных данных покупателя и продавца ненужна потому-что магазин имеет собственную службу безопасности (в случае чего охрана разберется на месте и вернет товар клиента...)
(А когда частное учреждение выставляет клиенту счет на оплату своих услуг - тогда в этом случае для оформления договоров используются приватные паспортные данные и оплатат происходи через кассу банка...)


Банковские веб-сайты - это партнерские веб-сайты которые разработанны для клиентов.
Дело в том что клиент не может засунуть свою электронную карту на такой веб-сайт, _поэтому для защиты клиентских данных используется двойное подтверждение авторизации: **ПИН-кодом** и **СМС-кодом**._
(А дальнейшая процедура работы на веб-сайте идентична как банкомату: основной сервер дает токен этому веб-сайту-**контрагенту** который предоставляет клиентский интерфейс и имеет право использовать API-банка для выполнения клиентских запросов...)

На банковском веб-сайте есть подготовленные **шаблоны** (_order_) - которые генерируют договоры для проплаты услуг...
(такие банковские услуги являются платными для партнеров)
После авторизации на банковский веб-сайт для клиента остается только просто ввести номер договора (который ранее был выдан этой фирмой на момент заказа услуги...) и нажать **проплатить** (_payment_)
- при этом будет отправлен запрос на API-банка основного сервера на оплату этого договора и напечатан **чек об проплате**...


Клиенты не доверяют чужим веб-сайтам выполнять проплату в банк за свои услуги...
(Потому-что в этом случае клиент не имеет никакой защиты. И лучше пользоваться только банковскими продуктами у которых есть служба поддержки)

Но все-же чужие веб-сайты способны и могут создавать договора...а оплату проводить уже в кассе самого банка.
(Но тогда в этом случае на честность доставки товара остается только расчитывать от такого веб-сайта) 

4. (Обычно чужие веб-сайты не могут принимать оплату на своем сайте, потому-что на таких сайтах нет прав-**контрагента**...)
`Но все-же API-банка предосталяет дополнительно такую услугу`:
- для этого нужно чтобы такой веб-сайт был проверен (имел **сертификат**-доверенности), зарегистрирован в банке и соблюдал требуемые стандарты от этого банка.
- и тогда имя хоста этого веб-сайта (не IP-адресс) получит доверие банка и специальный токен для прав доступа к API-банка...

(По этому токену чужой веб-сайт может принимать выполнятть оплату через API-банка, но все-же авторизироваться клиент должен на веб-сайте банка...)


#############################################################

В отличие от чужого веб-сайта, вебсайт-банка  имеет возможность восстанавливать клиента на клиентском веб-сайте:
- дело в том что регистрация клиента происходит в момент когда клиент получает электронную карточку (в офисе банка)
- _на (клиентском) веб-сайте клиента регистрировать уже не нужно, потому-что он уже существует в базе...форма регистрации клиента на веб-сайте банка напоминает поиск и выгрузку данных клиента из основного сервера **по году рождения** и **номеру карты**_ 

Кроме этого, клиенту рзрешено держать несколько электронных карт одновременно И на (клиентском) веб-сайте эта информация доступна для клиента.